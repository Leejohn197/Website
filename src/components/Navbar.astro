---
// src/components/Navbar.astro
import LanguageSwitcher from './common/LanguageSwitcher.astro';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

// 获取当前语言
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// 根据语言生成导航链接
const navLinks = {
  home: `/${lang}/`,
  about: `/${lang}/about`,
  exhibitors: `/${lang}/exhibitors`,
  contact: `/${lang}/contact`
};

// 导航文本（多语言）
const navText = {
  en: {
    home: 'Home',
    about: 'About',
    exhibitors: 'Exhibitors',
    contact: 'Contact',
    bookStand: 'Book a Stand'
  },
  id: {
    home: 'Beranda',
    about: 'Tentang',
    exhibitors: 'Peserta Pameran',
    contact: 'Hubungi',
    bookStand: 'Pesan Stan'
  },
  zh: {
    home: '首页',
    about: '关于展会',
    exhibitors: '展商服务',
    contact: '联系我们',
    bookStand: '我要参展'
  }
};

const texts = navText[lang] || navText.en;
---

<nav class="fixed w-full z-50 top-0 start-0 border-b border-batik bg-white/95 backdrop-blur-md shadow-sm transition-all duration-300">
  <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
    
    <a href={navLinks.home} class="flex items-center space-x-2 rtl:space-x-reverse group">
        <!-- Logo 图标 (可选) -->
        <!-- <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center text-white font-bold">J</div> -->
        
        <span class="self-center text-2xl font-heading font-bold whitespace-nowrap text-primary-900 group-hover:text-primary-700 transition-colors">
          Jakarta<span class="text-red-600">Expo</span>
        </span>
    </a>

    <div class="flex md:order-2 space-x-3 md:space-x-4 rtl:space-x-reverse items-center">
        <!-- 桌面端：语言切换器 -->
        <div class="hidden md:flex">
          <LanguageSwitcher />
        </div>
        
        <!-- 分隔线 -->
        <div class="hidden md:block h-6 w-px bg-neutral-300"></div>
        
        <!-- 桌面端：CTA 按钮 -->
        <a href={navLinks.exhibitors} class="hidden md:inline-block text-white bg-[#0e2c4c] hover:bg-[#0a2438] focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5">
          {texts.bookStand}
        </a>
        
        <!-- 移动端：汉堡菜单按钮 -->
        <button data-collapse-toggle="navbar-sticky" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-neutral-500 rounded-lg md:hidden hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-neutral-200 transition-colors" aria-controls="navbar-sticky" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <!-- 汉堡图标 -->
          <svg class="w-5 h-5 hamburger-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
          </svg>
          <!-- 关闭图标 -->
          <svg class="w-5 h-5 close-icon hidden" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
          </svg>
        </button>
    </div>

    <!-- 移动端菜单 - 完全复刻桌面端样式 -->
    <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
      <!-- 桌面端导航 -->
      <ul class="hidden md:flex md:space-x-8 rtl:space-x-reverse font-medium">
        <li>
          <a href={navLinks.home} class="block py-2 text-primary-700 font-bold hover:text-primary-600 transition-colors" aria-current="page">{texts.home}</a>
        </li>
        <li>
          <a href={navLinks.about} class="block py-2 text-neutral-700 hover:text-primary-600 transition-colors">{texts.about}</a>
        </li>
        <li>
          <a href={navLinks.exhibitors} class="block py-2 text-neutral-700 hover:text-primary-600 transition-colors">{texts.exhibitors}</a>
        </li>
        <li>
          <a href={navLinks.contact} class="block py-2 text-neutral-700 hover:text-primary-600 transition-colors">{texts.contact}</a>
        </li>
      </ul>

      <!-- 移动端菜单内容 - 白色背景，复刻桌面端 -->
      <div class="md:hidden w-full bg-white shadow-lg rounded-b-lg">
        <!-- 导航链接 -->
        <ul class="flex flex-col py-4 font-medium border-b border-neutral-100">
          <li>
            <a href={navLinks.home} class="block py-3 px-6 text-primary-700 font-bold hover:bg-neutral-50 transition-colors" aria-current="page">{texts.home}</a>
          </li>
          <li>
            <a href={navLinks.about} class="block py-3 px-6 text-neutral-700 hover:bg-neutral-50 hover:text-primary-600 transition-colors">{texts.about}</a>
          </li>
          <li>
            <a href={navLinks.exhibitors} class="block py-3 px-6 text-neutral-700 hover:bg-neutral-50 hover:text-primary-600 transition-colors">{texts.exhibitors}</a>
          </li>
          <li>
            <a href={navLinks.contact} class="block py-3 px-6 text-neutral-700 hover:bg-neutral-50 hover:text-primary-600 transition-colors">{texts.contact}</a>
          </li>
        </ul>

        <!-- 语言切换器 - 移动端 -->
        <div class="py-4 px-6 border-b border-neutral-100">
          <div class="flex items-center gap-3 text-sm font-medium">
            <span class="text-neutral-500 text-xs uppercase tracking-wide">Language:</span>
            <a
              href={`/en/${lang === 'en' ? '' : Astro.url.pathname.split('/').slice(2).join('/')}`}
              class={`transition-colors duration-200 ${lang === 'en' ? 'text-primary-700 font-bold' : 'text-neutral-400 hover:text-primary-600'}`}
            >
              EN
            </a>
            <span class="text-neutral-300">|</span>
            <a
              href={`/id/${lang === 'id' ? '' : Astro.url.pathname.split('/').slice(2).join('/')}`}
              class={`transition-colors duration-200 ${lang === 'id' ? 'text-primary-700 font-bold' : 'text-neutral-400 hover:text-primary-600'}`}
            >
              ID
            </a>
            <span class="text-neutral-300">|</span>
            <a
              href={`/zh/${lang === 'zh' ? '' : Astro.url.pathname.split('/').slice(2).join('/')}`}
              class={`transition-colors duration-200 ${lang === 'zh' ? 'text-primary-700 font-bold' : 'text-neutral-400 hover:text-primary-600'}`}
            >
              ZH
            </a>
          </div>
        </div>

        <!-- CTA 按钮 - 移动端 -->
        <div class="py-4 px-6">
          <a href={navLinks.exhibitors} class="block w-full text-center text-white bg-[#0e2c4c] hover:bg-[#0a2438] focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-3 shadow-md hover:shadow-lg transition-all">
            {texts.bookStand}
          </a>
        </div>
      </div>
    </div>

  </div>
</nav>

<script>
  // 移动端菜单切换功能
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButton = document.querySelector('[data-collapse-toggle="navbar-sticky"]');
    const navbarMenu = document.getElementById('navbar-sticky');
    const hamburgerIcon = toggleButton?.querySelector('.hamburger-icon');
    const closeIcon = toggleButton?.querySelector('.close-icon');
    
    if (toggleButton && navbarMenu && hamburgerIcon && closeIcon) {
      toggleButton.addEventListener('click', () => {
        // 切换菜单显示状态
        const isHidden = navbarMenu.classList.contains('hidden');
        navbarMenu.classList.toggle('hidden');
        
        // 切换图标
        hamburgerIcon.classList.toggle('hidden', !isHidden);
        closeIcon.classList.toggle('hidden', isHidden);
        
        // 更新 aria-expanded 属性
        toggleButton.setAttribute('aria-expanded', isHidden.toString());
        
        // 防止背景滚动（可选）
        if (isHidden) {
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = '';
        }
      });

      // 点击菜单链接后自动关闭菜单
      const menuLinks = navbarMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', () => {
          navbarMenu.classList.add('hidden');
          hamburgerIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
          toggleButton.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
        });
      });
    }
  });
</script>